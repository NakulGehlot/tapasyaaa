<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mental Health Chatbot</title>
  <link rel="stylesheet" href="index.css" />
</head>
<body class="bg-[var(--background)] text-[var(--foreground)] flex flex-col items-center justify-center h-screen">

  <!-- Chat container -->
  <div id="chat" class="glass-card w-full max-w-xl h-[80vh] flex flex-col p-4 overflow-y-auto space-y-3"></div>

  <!-- Input area -->
  <div class="w-full max-w-xl flex items-center mt-2 space-x-2">
    <input id="userInput" type="text" placeholder="Type your answer..." 
           class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--primary)]" />
    <button id="sendBtn" class="btn-hero px-4 py-2 rounded-lg">Send</button>
  </div>

  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");

    let questions = [
      "Hi there! How are you feeling today?",
      "Have you been experiencing any stress lately?",
      "Are you feeling anxious or low?",
      "Would you like to share whatâ€™s been on your mind?"
    ];

    let questionIndex = 0;

    function appendMessage(message, sender) {
      const row = document.createElement("div");
      row.className = `flex items-start ${sender === 'user' ? 'justify-end' : 'justify-start'}`;

      const bubble = document.createElement("div");
      bubble.className = `chat-bubble max-w-[80%] px-4 py-3 rounded-2xl shadow 
        ${sender === 'user' 
          ? 'bg-[var(--secondary)] rounded-br-none' 
          : 'bg-[var(--primary-light)] rounded-bl-none'}`;

      bubble.innerText = message;
      row.appendChild(bubble);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    function botAskQuestion() {
      if (questionIndex < questions.length) {
        setTimeout(() => {
          appendMessage(questions[questionIndex], "bot");
        }, 500);
      } else {
        setTimeout(() => {
          // Final bot message with button
          const row = document.createElement("div");
          row.className = "flex items-start justify-start";

          const bubble = document.createElement("div");
          bubble.className = "chat-bubble max-w-[80%] px-4 py-3 rounded-2xl shadow bg-[var(--primary-light)] text-[var(--foreground)] rounded-bl-none";

          const text = document.createElement("p");
          text.innerText = "Thank you for sharing with me ðŸ’™. You can book a therapy session here:";
          bubble.appendChild(text);

          const button = document.createElement("a");
          button.href = "https://docs.google.com/forms/d/e/1FAIpQLSdG8BIw4bHRIJ9MgZ_A7yA3Qvmx2fvqo_Lr2DuEZqlGXorX1A/viewform?usp=sharing";
          button.target = "_blank";
          button.className = "block mt-2 bg-[var(--primary)] hover:bg-[var(--primary-light)] text-[var(--foreground)] font-bold px-4 py-2 rounded-lg shadow text-center";
          button.innerText = "ðŸ“Œ Book a Session";
          bubble.appendChild(button);

          row.appendChild(bubble);
          chat.appendChild(row);
          chat.scrollTop = chat.scrollHeight;
        }, 500);
      }
    }

    function handleUserInput() {
      const text = input.value.trim();
      if (!text) return;

      appendMessage(text, "user");

      // Check for bad feeling keywords
      const badWords = ["sad", "not good", "depressed", "anxious", "low", "stressed"];
      if (badWords.some(word => text.toLowerCase().includes(word))) {
        setTimeout(() => {
          appendMessage("Iâ€™m here for you ðŸŒ¸. You are stronger than you think, and every step forward matters. ðŸ’ª", "bot");
        }, 500);
      }

      input.value = "";
      questionIndex++;
      botAskQuestion();
    }

    sendBtn.addEventListener("click", handleUserInput);
    input.addEventListener("keypress", (e) => {
      if (e.key === "Enter") handleUserInput();
    });

    // Start conversation
    botAskQuestion();
  </script>
</body>
</html>
