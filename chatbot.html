<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yati â€” Mental Health Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(135deg, #a8dadc, #d0f0c0);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center text-gray-800">

  <div class="w-full max-w-lg bg-white rounded-2xl shadow-xl overflow-hidden border border-green-100">
    <div class="px-5 py-4 bg-gradient-to-r from-green-200 to-blue-200 border-b border-green-300 flex items-center gap-2">
      <div class="w-2.5 h-2.5 rounded-full bg-green-500 animate-pulse"></div>
      <h1 class="text-lg font-semibold text-green-900">Yati</h1>
    </div>

    <div id="chat" class="h-[70vh] overflow-y-auto p-4 space-y-3 bg-gradient-to-br from-blue-50 to-green-50"></div>

    <form id="chat-form" class="flex items-center gap-2 p-3 bg-gradient-to-r from-green-100 to-blue-100 border-t border-green-200">
      <input id="user-input" type="text" placeholder="Type your answer..."
        class="flex-1 px-4 py-2 rounded-lg bg-white border border-green-200 focus:outline-none focus:ring-2 focus:ring-green-300" />
      <button type="submit"
        class="px-4 py-2 rounded-lg bg-green-400 hover:bg-green-500 text-white">Send</button>
    </form>
  </div>

  <script>
    const BOOKING_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdG8BIw4bHRIJ9MgZ_A7yA3Qvmx2fvqo_Lr2DuEZqlGXorX1A/viewform?usp=sharing";

    const chat = document.getElementById('chat');
    const form = document.getElementById('chat-form');
    const input = document.getElementById('user-input');

    function bubble(text, sender = 'bot') {
      const row = document.createElement('div');
      row.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
      const b = document.createElement('div');
      b.className =
        `max-w-[80%] px-4 py-2 rounded-2xl text-sm leading-relaxed shadow 
        ${sender === 'user'
          ? 'bg-green-200 text-green-900 rounded-br-none'
          : 'bg-blue-200 text-blue-900 rounded-bl-none'}`;
      b.innerHTML = text;
      row.appendChild(b);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    const answers = {};
    const questions = [
      { id: "name", text: "Hi, Iâ€™m Yati ðŸ˜Š Whatâ€™s your first name?" },
      { id: "mood", text: "How are you feeling today?" },
      { id: "duration", text: "Has this been going on for more than two weeks?" },
      { id: "impact", text: "Is it affecting your daily life (sleep, work, focus)?" },
      { id: "help", text: "Would you like to book a therapy session?" }
    ];

    const motivationalResponses = {
      mood: [
        { keywords: ["sad", "low", "bad", "not good"], text: "ðŸ’™ Iâ€™m sorry youâ€™re feeling this way. Storms donâ€™t last forever â€” you are stronger than you think." },
        { keywords: ["stressed", "anxious", "anxiety"], text: "ðŸ’š Itâ€™s okay to feel anxious. Take a deep breath â€” you are safe here and you matter." }
      ],
      impact: [
        { keywords: ["yes"], text: "ðŸŒŸ Caring for yourself is powerful â€” and seeking help is a brave step." }
      ]
    };

    let qIndex = 0;

    function askNextQuestion() {
      if (qIndex < questions.length) {
        bubble(questions[qIndex].text);
      } else {
        bubble(`Thank you for sharing. You can book a therapy session here: <a href="${BOOKING_FORM_URL}" target="_blank" class="underline font-semibold">Book Therapy</a> ðŸ’š`);
      }
    }

    function checkMotivationalResponse(questionId, userAnswer) {
      const responses = motivationalResponses[questionId];
      if (!responses) return null;
      const lowerAns = userAnswer.toLowerCase();
      for (let resp of responses) {
        if (resp.keywords.some(k => lowerAns.includes(k))) {
          return resp.text;
        }
      }
      return null;
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      bubble(text, 'user');
      answers[questions[qIndex].id] = text;

      const motivation = checkMotivationalResponse(questions[qIndex].id, text);
      qIndex++;
      input.value = "";

      setTimeout(() => {
        if (motivation) {
          bubble(motivation);
          setTimeout(askNextQuestion, 1200);
        } else {
          askNextQuestion();
        }
      }, 600);
    });

    window.onload = () => {
      askNextQuestion();
    }
  </script>
</body>
</html>
