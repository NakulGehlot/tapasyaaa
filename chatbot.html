<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Yati â€” Mental Health Support</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 min-h-screen flex items-center justify-center text-white">

  <!-- Chat Window -->
  <div class="w-full max-w-lg bg-gray-800 rounded-2xl shadow-xl overflow-hidden">
    <div class="px-5 py-4 bg-gray-900 border-b border-gray-700 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-2.5 h-2.5 rounded-full bg-teal-400 animate-pulse"></div>
        <h1 class="text-lg font-semibold">Yati</h1>
      </div>
      <span class="text-xs text-gray-400">Here for you ðŸ’š</span>
    </div>

    <div id="chat" class="h-[60vh] overflow-y-auto p-4 space-y-3 bg-gray-800"></div>

    <form id="chat-form" class="flex items-center gap-2 p-3 bg-gray-900 border-t border-gray-700">
      <input id="user-input" type="text" placeholder="Type your message..."
        class="flex-1 px-4 py-2 rounded-lg bg-gray-700/70 text-white placeholder-gray-400 focus:outline-none"
        disabled />
      <button type="submit" disabled
        class="px-4 py-2 rounded-lg bg-gray-700 text-gray-400 cursor-not-allowed">Send</button>
    </form>
  </div>

  <!-- Questionnaire Overlay -->
  <div id="overlay" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4">
    <div class="w-full max-w-lg bg-gray-800 rounded-2xl shadow-2xl overflow-hidden">
      <div class="px-5 py-4 bg-gray-900 border-b border-gray-700">
        <h2 class="text-lg font-semibold">Quick, gentle check-in</h2>
        <p class="text-xs text-gray-400 mt-1">
          If you are in immediate danger or thinking of harming yourself, please call your local emergency number (India: <strong>112</strong>) immediately.
        </p>
      </div>
      <div id="qstream" class="p-4 space-y-4 max-h-[60vh] overflow-y-auto"></div>
    </div>
  </div>

  <script>
    const BOOKING_FORM_URL = "https://docs.google.com/forms/d/e/1FAIpQLSdG8BIw4bHRIJ9MgZ_A7yA3Qvmx2fvqo_Lr2DuEZqlGXorX1A/viewform?usp=sharing";

    const chat = document.getElementById('chat');
    const form = document.getElementById('chat-form');
    const input = document.getElementById('user-input');
    const overlay = document.getElementById('overlay');
    const qstream = document.getElementById('qstream');

    function bubble(text, sender = 'bot') {
      const row = document.createElement('div');
      row.className = `flex ${sender === 'user' ? 'justify-end' : 'justify-start'}`;
      const b = document.createElement('div');
      b.className =
        `max-w-[80%] px-4 py-2 rounded-2xl text-sm leading-relaxed shadow 
        ${sender === 'user' ? 'bg-teal-300 text-teal-900 rounded-br-none' : 'bg-teal-700 text-white rounded-bl-none'}`;
      b.innerHTML = text;
      row.appendChild(b);
      chat.appendChild(row);
      chat.scrollTop = chat.scrollHeight;
    }

    function systemNote(text) {
      const n = document.createElement('div');
      n.className = "text-xs text-gray-400 text-center my-2";
      n.innerHTML = text;
      chat.appendChild(n);
      chat.scrollTop = chat.scrollHeight;
    }

    const answers = {};
    const questions = [
      { id: "name", prompt: "Hi, I'm Yati. Whatâ€™s your first name?", type: "text" },
      { id: "mood", prompt: "How are you feeling today?", type: "buttons", options: ["Stressed", "Anxious", "Low", "Okay"] },
      { id: "duration", prompt: "Has this been going on for more than two weeks?", type: "buttons", options: ["Yes", "No"] },
      { id: "help", prompt: "Would you like to book a therapy session?", type: "buttons", options: ["Yes", "Maybe later"] }
    ];

    let qIndex = 0;

    function renderQuestion(q) {
      const wrap = document.createElement('div');
      wrap.className = "space-y-2";

      const label = document.createElement('div');
      label.className = "text-sm text-white";
      label.textContent = q.prompt;
      wrap.appendChild(label);

      if (q.type === "text") {
        const inp = document.createElement('input');
        inp.type = "text";
        inp.placeholder = "Type here...";
        inp.className = "w-full px-3 py-2 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none";
        inp.addEventListener('keydown', (e) => {
          if (e.key === "Enter") {
            answers[q.id] = inp.value.trim();
            nextQuestion();
          }
        });
        wrap.appendChild(inp);
      } else {
        const btnRow = document.createElement('div');
        btnRow.className = "flex flex-wrap gap-2";
        q.options.forEach(opt => {
          const btn = document.createElement('button');
          btn.type = "button";
          btn.textContent = opt;
          btn.className = "px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600";
          btn.onclick = () => {
            answers[q.id] = opt;
            nextQuestion();
          };
          btnRow.appendChild(btn);
        });
        wrap.appendChild(btnRow);
      }

      qstream.appendChild(wrap);
      qstream.scrollTop = qstream.scrollHeight;
    }

    function nextQuestion() {
      qIndex++;
      qstream.innerHTML = "";
      if (qIndex < questions.length) {
        renderQuestion(questions[qIndex]);
      } else {
        finishCheckIn();
      }
    }

    function startQuestionnaire() {
      qIndex = 0;
      qstream.innerHTML = "";
      renderQuestion(questions[qIndex]);
    }

    function finishCheckIn() {
      overlay.classList.add('hidden');
      bubble(`Thanks for sharing, ${answers.name || "friend"}. I understand you are feeling ${answers.mood}.`);
      if (answers.help === "Yes") {
        bubble(`Hereâ€™s the link to book your session: <a href="${BOOKING_FORM_URL}" target="_blank" class="underline">Book Therapy</a>`);
      } else {
        bubble(`Whenever you feel ready, you can use this link: <a href="${BOOKING_FORM_URL}" target="_blank" class="underline">Book Therapy</a>`);
      }
      enableChat();
    }

    function enableChat() {
      input.disabled = false;
      form.querySelector('button').disabled = false;
      form.querySelector('button').className =
        "px-4 py-2 rounded-lg bg-teal-600 hover:bg-teal-500";
    }

    function botReply(userText) {
      const lower = userText.toLowerCase();
      if (lower.includes("stress") || lower.includes("stressed")) {
        bubble("I hear you. Stress can be tough. Would you like me to share some relaxation tips?");
      } else if (lower.includes("anxiety")) {
        bubble("Anxiety can feel overwhelming. Remember to take slow breaths. You can also book a therapy session.");
      } else if (lower.includes("help")) {
        bubble(`You can get help here: <a href="${BOOKING_FORM_URL}" target="_blank" class="underline">Book Therapy</a>`);
      } else {
        bubble("Iâ€™m here for you. Tell me more about how youâ€™re feeling.");
      }
    }

    form.addEventListener('submit', e => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      bubble(text, 'user');
      input.value = "";
      botReply(text);
    });

    window.onload = () => {
      bubble("Hello! Iâ€™m Yati ðŸ˜Š Letâ€™s start with a quick check-in.");
      startQuestionnaire();
    }
  </script>
</body>
</html>
